<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puntos Móviles de Reciclaje en Temuco</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="StylesMapa.css">

    <style>
        #map {
            height: 600px;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>Puntos Móviles de Reciclaje en Temuco</h1>
    <button onclick="filterByLocation()">Buscar Puntos Cercanos</button>
    <button onclick="showUserLocation()">Mostrar Mi Ubicación</button>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Inicializar el mapa centrado en Temuco
        var map = L.map('map').setView([-38.7359, -72.5904], 13);

        // Limitar el área de movimiento del mapa a Temuco
        var bounds = L.latLngBounds(
            L.latLng(-38.77, -72.67), // Suroeste
            L.latLng(-38.70, -72.51)  // Noreste
        );
        map.setMaxBounds(bounds);
        
        // Evitar que el usuario se desplace fuera de los límites
        map.on('drag', function() {
            map.panInsideBounds(bounds, { animate: false });
        });

        // Establecer los niveles de zoom mínimo y máximo
        map.setMinZoom(12);
        map.setMaxZoom(16);

        // Añadir mapa base desde OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Definir el icono personalizado para los puntos móviles
        var recycleIcon = L.icon({
            iconUrl: 'https://cdn-icons-png.flaticon.com/512/365/365116.png',  // Icono de reciclaje limpio
            iconSize: [30, 30],  // Tamaño del icono
            iconAnchor: [15, 30],  // Anclar el icono al centro
            popupAnchor: [0, -30]  // Anclar el popup arriba del icono
        });

        // Lista de puntos móviles con sus datos
        var puntosReciclaje = [
            {
                name: "Punto Móvil de reciclaje Pedro de Valdivia",
                coords: [-38.7382, -72.5892],
                direccion: "Av. Gabriela Mistral con Calle Recreo, Temuco.",
                horario: "Primera y Segunda semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            },
            {
                name: "Punto Móvil de reciclaje Costanera del Cautín",
                coords: [-38.7440, -72.6133],
                direccion: "Río Rhin con Av. Costanera, Temuco.",
                horario: "Primera y Segunda semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            },
            {
                name: "Punto Móvil de reciclaje Fundo El Carmen",
                coords: [-38.7079, -72.6522],
                direccion: "Los Químicos con Los Fundadores, Temuco.",
                horario: "Primera y Segunda semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            },
            {
                name: "Punto Móvil de reciclaje Amanecer",
                coords: [-38.7520, -72.6081],
                direccion: "Calle Géminis entre Venus y Neptuno, Temuco.",
                horario: "Primera y Segunda semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            },
            {
                name: "Punto Móvil de reciclaje Labranza",
                coords: [-38.7475, -72.6375],
                direccion: "Calle 1 Norte a un costado del Colegio NewHarvest, Temuco.",
                horario: "Primera y Segunda semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            },
            {
                name: "Punto Móvil de reciclaje Centro",
                coords: [-38.7309, -72.5889],
                direccion: "Monte Ararat con Prieto Norte, Temuco.",
                horario: "Primera y Segunda semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            },
            {
                name: "Punto Móvil de reciclaje Pueblo Nuevo",
                coords: [-38.7427, -72.6067],
                direccion: "Bascuñán Santa María con Valdivia y David Perry, Temuco.",
                horario: "Primera y Segunda semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            },
            {
                name: "Punto Móvil de reciclaje Pedro de Valdivia",
                coords: [-38.7290, -72.5972],
                direccion: "Ayelen con Circunvalación Francisco Huenchumilla, Temuco.",
                horario: "Tercera y Cuarta semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            },
            {
                name: "Punto Móvil de reciclaje Costanera de Cautín",
                coords: [-38.7443, -72.6145],
                direccion: "Av. Costanera con Av. Pircunche, Temuco.",
                horario: "Tercera y Cuarta semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            },
            {
                name: "Punto Móvil de reciclaje Fundo El Carmen",
                coords: [-38.7087, -72.6539],
                direccion: "Calle Jorge Teillier con Los Escritores, Temuco.",
                horario: "Tercera y Cuarta semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            },
            {
                name: "Punto Móvil de reciclaje Sector Poniente",
                coords: [-38.7385, -72.6075],
                direccion: "Interior Parque Estadio Germán Becker, Temuco.",
                horario: "Tercera y Cuarta semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            },
            {
                name: "Punto Móvil de reciclaje Amanecer",
                coords: [-38.7523, -72.6100],
                direccion: "Venecia con Garibaldi, Temuco.",
                horario: "Tercera y Cuarta semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            },
            {
                name: "Punto Móvil de reciclaje Centro",
                coords: [-38.7320, -72.5977],
                direccion: "Estacionamiento Unimarc San Martín, Temuco.",
                horario: "Tercera y Cuarta semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            },
            {
                name: "Punto Móvil de reciclaje Pueblo Nuevo",
                coords: [-38.7402, -72.6149],
                direccion: "Rudecindo Ortega 01780, Al interior del Outlet Easton, Temuco.",
                horario: "Tercera y Cuarta semana de cada mes",
                materiales: "Botellas PET, cartón, papel, latas de aluminio, revistas, diarios y pilas."
            }
        ];

        // Añadir cada punto móvil al mapa con su popup
        puntosReciclaje.forEach(function(punto) {
            var marker = L.marker(punto.coords, { icon: recycleIcon }).addTo(map);
            marker.bindPopup(`
                <strong>${punto.name}</strong><br>
                <b>Dirección:</b> ${punto.direccion}<br>
                <b>Horarios:</b> ${punto.horario}<br>
                <b>¿Qué se puede reciclar aquí?:</b> ${punto.materiales}
            `);
        });
 

    var userIcon = L.icon({
        iconUrl: 'https://cdn-icons-png.flaticon.com/512/149/149071.png',  // Icono de ubicación
        iconSize: [35, 35],  // Tamaño del icono
        iconAnchor: [17, 35],  // Punto de anclaje (la punta del ícono)
        popupAnchor: [0, -35]  // Punto donde se mostrará el popup relativo al ícono
    });

    // Función para mostrar la ubicación actual del usuario
    function showUserLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var userLat = position.coords.latitude;
                var userLon = position.coords.longitude;

                // Añadir un marcador con el icono de ubicación del usuario
                var userMarker = L.marker([userLat, userLon], { icon: userIcon }).addTo(map);
                userMarker.bindPopup("<strong>¡Estás aquí!</strong>").openPopup();

                // Centramos el mapa en la ubicación del usuario
                map.setView([userLat, userLon], 13);
            }, function() {
                alert("No se pudo obtener la ubicación actual.");
            });
        } else {
            alert("La geolocalización no está disponible en este navegador.");
        }
    }
    // Función para calcular la distancia entre dos coordenadas
    function getDistance(lat1, lon1, lat2, lon2) {
            var R = 6371; // Radio de la Tierra en km
            var dLat = (lat2 - lat1) * Math.PI / 180;
            var dLon = (lon2 - lon1) * Math.PI / 180;
            var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon / 2) * Math.sin(dLon / 2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            var distance = R * c;
            return distance; // Distancia en km
        }

        // Función para obtener la ubicación actual del usuario y filtrar los puntos cercanos
    function filterByLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var userLat = position.coords.latitude;
                var userLon = position.coords.longitude;

                // Filtrar puntos de reciclaje a menos de 5 km del usuario
                var puntosCercanos = puntosReciclaje.filter(function(punto) {
                    var distance = getDistance(userLat, userLon, punto.coords[0], punto.coords[1]);
                    return distance <= 5; // Filtrar los que estén a 5 km o menos
                });

                // Limpiar el mapa de los marcadores anteriores
                map.eachLayer(function(layer) {
                    if (layer instanceof L.Marker) {
                        map.removeLayer(layer);
                    }
                });

                // Añadir los puntos cercanos al mapa
                puntosCercanos.forEach(function(punto) {
                    var marker = L.marker(punto.coords, { icon: recycleIcon }).addTo(map);
                    marker.bindPopup(`
                        <strong>${punto.name}</strong><br>
                        <b>Dirección:</b> ${punto.direccion}<br>
                        <b>Horarios:</b> ${punto.horario}<br>
                        <b>¿Qué se puede reciclar aquí?:</b> ${punto.materiales}
                    `);
                });

                if (puntosCercanos.length === 0) {
                    alert("No se encontraron puntos de reciclaje cercanos.");
                }
            }, function() {
                alert("No se pudo obtener la ubicación actual.");
            });
        } else {
            alert("La geolocalización no está disponible en este navegador.");
        }
    }
    </script>
</body>
</html>


